rule Malware_HnaZtD_TelegramC2
{
    meta:
        description = "Detects malware sample communicating to Telegram API with SQL manipulation"
        author = "Danish & Ghufron Analysis"
        date = "2025-11-25"
        hash = "C916272576422988A28E293B802A1408997D0D11E5558C8A410009BADE568027"

    strings:
        $url1 = "https://api.telegram.org" wide ascii
        $url2 = "/sendDocument" wide ascii
        $domain1 = "api.telegram.org" ascii
        $domain2 = "telegram.org" ascii

        $sql1 = "select * from Mesajlar1" wide ascii
        $sql2 = "delete from Oda101" wide ascii
        $sql3 = "UPDATE M SET" wide ascii

        $pdb = "HnaZtD.pdb" wide ascii

        $ns1 = "System.Security.Cryptography" ascii
        $ns2 = "System.Diagnostics" ascii
        $ns3 = "MemoryStream" ascii

        $orig = "HnaZtD.exe" ascii

    condition:
        uint16(0) == 0x5A4D and
        ( any of ($url*) or any of ($sql*) or any of ($ns*) or $pdb or $orig )
}
